<html>
  <head><style>#out {font-family: monospace; padding: 1em;}</style></head>
  <div id="loading">Loading...</div>
  <script src="lunr.js"></script>
  <script src="alldocs.js"></script>
  <script>
  var index = lunr(function () {
    this.field('title', {boost: 10})
    this.field('text')
    this.ref('url')
  })
  alldocs.forEach(function(d){index.add(d);});
</script>
<input AUTOFOCUS type="text" size="30" id="in" onchange="go();"/>
<div id="out">Press enter to search.</div>
<script>
  var o = document.querySelector("#out");
  var l = document.querySelector("#loading");
  l.parentNode.removeChild(l);
  var processing = false;
  var q = [];
  function go(){
    o.innerHTML = "Searching...";
    var i = document.querySelector("#in").value;
    q.unshift(i);
    var lines = "";
    setTimeout(function(){
      if (q.length === 0) return;
      var t0 = (new Date()).getTime();
      var r = index.search(q[0]);
      var t1 = (new Date()).getTime();
      lines += (t1 - t0) + "ms.\n<br>" 
      JSON.stringify(r, null, 2).split(/\n/).forEach(function(l){
        l = l.replace(/^ +/g, "&nbsp;");
        m = l.match(/.+"(.*html.*)"/);
        if (m) {l = l.replace(m[1], "<a target='_blank' href='http://hl7-fhir.github.io/"+m[1]+"'>"+m[1]+"</a>");}
        lines += (l + "<br>");
      });
      o.innerHTML = lines;
      q = [];
    });
  };
</script>
</html>
